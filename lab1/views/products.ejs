<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product Management</title>
</head>
<body>
  <div class="header">
    <h1>Product Management System</h1>
    <div class="user-info">
      <span>Welcome, <strong><%= user %></strong></span>
      <a href="/users" class="btn btn-secondary">Manage Users</a>
      <a href="/logout" class="btn btn-danger">Logout</a>
    </div>
  </div>

  <div class="form-container">
    <h2 id="formTitle">Add New Product</h2>
    <form id="productForm" action="/products/add" method="post">
      <input type="hidden" id="id" name="id" value="">

      <div class="form-group">
        <label for="name">Product Name:</label>
        <input type="text" id="name" name="name" required>
      </div>

      <div class="form-group">
        <label for="price">Price:</label>
        <input type="number" step="0.01" id="price" name="price" required>
      </div>

      <div class="form-group">
        <label for="quantity">Quantity:</label>
        <input type="number" id="quantity" name="quantity" required>
      </div>

      <div class="form-group">
        <label></label>
        <button id="submitBtn" type="submit" class="btn btn-primary">Add Product</button>
        <button type="button" onclick="setAddMode()" class="btn btn-secondary">Cancel</button>
      </div>
    </form>
  </div>

  <h2>Products List</h2>
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Product Name</th>
        <th>Price</th>
        <th>Quantity</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <% if (products.length === 0) { %>
        <tr>
          <td colspan="5" style="text-align: center;">No products found. Add your first product!</td>
        </tr>
      <% } else { %>
        <% products.forEach(p => { %>
          <tr>
            <td><%= p.id %></td>
            <td><%= p.name %></td>
            <td><%= parseFloat(p.price).toFixed(2) %></td>
            <td><%= p.quantity %></td>
            <td class="actions">
              <button type="button" class="btn btn-warning edit-btn"
                      data-id="<%= p.id %>"
                      data-name="<%= p.name %>"
                      data-price="<%= p.price %>"
                      data-quantity="<%= p.quantity %>"
                      onclick="editFromButton(this)">Edit</button>

              <form action="/products/delete" method="post" style="display:inline;"
                    onsubmit="return confirm('Bạn có muốn xóa sản phẩm này không?')">
                <input type="hidden" name="id" value="<%= p.id %>">
                <button type="submit" class="btn btn-danger">Delete</button>
              </form>
            </td>
          </tr>
        <% }) %>
      <% } %>
    </tbody>
  </table>

  <script>
    // Edit product - populate form with product data
    function editFromButton(btn) {
      var id = btn.getAttribute('data-id');
      var name = btn.getAttribute('data-name');
      var price = btn.getAttribute('data-price');
      var quantity = btn.getAttribute('data-quantity');
      editProduct(id, name, price, quantity);
    }

    function editProduct(id, name, price, quantity) {
      var form = document.getElementById('productForm');
      form.action = '/products/update';
      document.getElementById('id').value = id;
      document.getElementById('name').value = name;
      document.getElementById('price').value = price;
      document.getElementById('quantity').value = quantity;
      document.getElementById('submitBtn').textContent = 'Update Product';
      document.getElementById('submitBtn').className = 'btn btn-warning';
      document.getElementById('formTitle').textContent = 'Edit Product';

      // Scroll to form
      document.querySelector('.form-container').scrollIntoView({ behavior: 'smooth' });
    }

    // Reset form to add mode
    function setAddMode() {
      var form = document.getElementById('productForm');
      form.action = '/products/add';
      document.getElementById('id').value = '';
      form.reset();
      document.getElementById('submitBtn').textContent = 'Add Product';
      document.getElementById('submitBtn').className = 'btn btn-primary';
      document.getElementById('formTitle').textContent = 'Add New Product';
    }
  </script>
</body>
</html>
